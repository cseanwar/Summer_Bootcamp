---

- hosts: ubuntu
  
  become_user: root
 
  vars:
    ntp_server: ntp.se


  tasks:
   # This task is to ensure chrony is not installed. Having chrony and ntp both on system may cause issues.
   - name: Remove chrony client package from the system
     apt:
      name=chrony
      state=absent
     tags: remove_chrony,start_ntp

   # This task is to ensure ntp package is installed
   - name: Check/Install ntp client package
     apt:
      name=ntp
      state=present
     tags: install_ntp,start_ntp


   # This task is to copy the custom ntp.conf file 
   - name: Deploy ntp.conf file to the clients
     template:
       src=templates/ntp.j2
       dest=/etc/ntp.conf
       owner=root
       group=root
       mode=0644
       backup=yes
     notify: start_restart_ntp_client
     tags: copy_ntp_conf,start_ntp


   
  handlers:
    # This task is to ensure ntp service is started
    - name: start_restart_ntp_client
      service:
        name=ntp
        state=restarted
        enabled=yes
